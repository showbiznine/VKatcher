<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:VKatcher.Views"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:ViewModels="using:VKatcher.ViewModels"
      xmlns:Converters="using:VKatcher.Converters"
      xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
      xmlns:Core="using:Microsoft.Xaml.Interactions.Core"
      xmlns:Media="using:Microsoft.Xaml.Interactions.Media"
      x:Name="pageRoot"
      x:Class="VKatcher.Views.FeedPage"
      mc:Ignorable="d"
      DataContext="{Binding Feed, Source={StaticResource Locator}}">

    <Page.Resources>
        <Converters:SubscribedColorConverter x:Key="SubscribedColorConverter" />
        <Converters:SubscribedStringConverter x:Key="SubscribedStringConverter" />
        <Converters:BooleanVisibilityConverter x:Key="BooleanVisibilityConverter" />
        <Storyboard x:Name="ToggleSubscribe">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)"
                                           Storyboard.TargetName="lblSubscribe">
                <EasingDoubleKeyFrame KeyTime="0"
                                      Value="20" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.167"
                                      Value="0">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <CircleEase EasingMode="EaseOut" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.533"
                                      Value="0" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.683"
                                      Value="-20">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <CircleEase EasingMode="EaseIn" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)"
                                           Storyboard.TargetName="lblSubscribe">
                <EasingDoubleKeyFrame KeyTime="0"
                                      Value="0" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.167"
                                      Value="1" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.533"
                                      Value="1" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.683"
                                      Value="0" />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </Page.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="168" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <ListView x:Name="listView"
                  Grid.Row="1"
                  Background="Transparent"
                  ItemTemplate="{StaticResource PostListTemplate}"
                  ItemsSource="{Binding _wallPosts}"
                  SelectionMode="None">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalAlignment"
                            Value="Stretch" />
                    <Setter Property="HorizontalContentAlignment"
                            Value="Stretch" />
                    <Setter Property="Margin"
                            Value="0" />
                    <Setter Property="Padding"
                            Value="0" />
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>
        <TextBlock x:Name="lblGroupName"
                   HorizontalAlignment="Left"
                   TextWrapping="Wrap"
                   Text="{Binding _currentGroup.name}"
                   VerticalAlignment="Bottom"
                   Margin="12,0,0,12"
                   FontSize="22"
                   FontWeight="Black"
                   TextLineBounds="TrimToBaseline" />
        <ProgressRing x:Name="prgRing"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Grid.Row="1"
                      Width="48"
                      Height="48"
                      IsActive="True"
                      Visibility="{Binding _inCall, Converter={StaticResource BooleanVisibilityConverter}}" />
        <StackPanel Margin="0,0,12,4"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Orientation="Horizontal">
            <TextBlock x:Name="lblSubscribe"
                       HorizontalAlignment="Left"
                       TextWrapping="Wrap"
                       Text="{Binding _currentGroup.IsSubscribed, Converter={StaticResource SubscribedStringConverter}}"
                       VerticalAlignment="Center"
                       d:LayoutOverrides="TopMargin, BottomMargin, LeftPosition, RightPosition"
                       FontWeight="Thin"
                       TextLineBounds="TrimToBaseline"
                       Opacity="0"
                       RenderTransformOrigin="0.5,0.5">
                <TextBlock.RenderTransform>
                    <CompositeTransform TranslateY="20" />
                </TextBlock.RenderTransform>
            </TextBlock>
            <Button x:Name="btnSubscribe"
                    Content="&#xE701;"
                    VerticalAlignment="Top"
                    FontFamily="Segoe MDL2 Assets"
                    FontSize="20"
                    BorderThickness="0"
                    Padding="8"
                    Style="{StaticResource SmallIconButton}"
                    HorizontalAlignment="Stretch"
                    d:LayoutOverrides="LeftMargin, RightMargin"
                    Foreground="{Binding _currentGroup.IsSubscribed, Converter={StaticResource SubscribedColorConverter}}"
                    Command="{Binding SubscribeCommand, Mode=OneWay}">
                <Button.Background>
                    <SolidColorBrush Color="{ThemeResource SystemAltHighColor}" />
                </Button.Background>
                <Interactivity:Interaction.Behaviors>
                    <Core:EventTriggerBehavior EventName="Click">
                        <Media:ControlStoryboardAction Storyboard="{StaticResource ToggleSubscribe}" />
                    </Core:EventTriggerBehavior>
                </Interactivity:Interaction.Behaviors>
            </Button>
        </StackPanel>
    </Grid>
</Page>
